#!/usr/bin/env coffee

path = require 'path'
optimist = require('optimist')

argv = require('optimist').usage('Compiles underscore.js templates into javascript files.')
.options(
  s:
    alias: 'source-dir'
    describe: 'The directory where all your template files reside.'
    demand: true
  o:
    alias: 'out-dir'
    describe: 'The directory where _plate will put the compiled template files.'
    default: '<source-dir>/_compiled'
  c:
    alias: 'compile-style'
    describe: 'Options include: "combined" (single file), "directory" (one ' +
              'file per directory) and "file" (one output file per input file)'
    default: 'directory'
  e:
    alias: 'extension'
    describe: '_plate will look for files with the given extension.'
    default: 'html'
  n:
    alias: 'namespace'
    describe: 'The namespace to add your compiled template functions to.'
    default: 'window'
).argv

# Underscorify hyphenated keys
re_hyphen = /(\w*)\-(\w*)/g
for key, value of argv
  if re_hyphen.test key
    _key = key.replace re_hyphen, '$1_$2'
    argv[_key] = value

# Make sure the out_dir default is within the context of source_dir
argv.out_dir = argv.out_dir.replace /<source\-dir>/, argv.source_dir

plate = require '../plate'
plate.compile argv
