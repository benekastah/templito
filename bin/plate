#!/usr/bin/env coffee

path = require 'path'
argv = process.argv.slice 2

switch argv[0]
  when null, undefined, '', '-h', '--help'
    # Dislay the help message and quit
    console.log """
    Usage:

      plate <source_dir> [<out_dir> <file_level> <extension> <namespace>]

      source_dir:           The directory where all your template files reside.
                            REQUIRED.
      out_dir:              The directory to put the compiled template files.
                            Defaults to '<source_dir>/_compiled'.
      file_level:           The level you want your files compiled to. 0 means
                            you have one file for the whole directory. 1 means
                            you have one file for each file or directory in
                            the first level or tree. 2 is the same for the
                            second level of your tree, and so on.
      extension:            The extension of your template files. Defaults to
                            'html'.
      namespace:            The default namespace to add your templates to.
                            Defaults to `window`. If your source_dir is called
                            'templates', and you have a source file called
                            'foo.html', you can access it at
                            `<namespace>.Templates.foo`.

    """
    process.exit 0


[source_dir, out_dir, file_level, extension, namespace] = argv
out_dir or= path.join source_dir, '_compiled'
file_level or= 1
extension or= 'html'
namespace or= 'window'

plate = require '../plate'
options = {source_dir, out_dir, file_level, extension, namespace}
plate.compile options
